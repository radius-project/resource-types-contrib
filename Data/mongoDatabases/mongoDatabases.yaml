namespace: Radius.Data
types:
  mongoDatabases:
    description: |
      The Radius.Data/mongoDatabases Resource Type provisions a MongoDB database instance on Kubernetes using Terraform. 
      
      Start by adding a mongoDatabases resource to your application definition Bicep file:
      
        resource mongo 'Radius.Data/mongoDatabases@2025-10-01-preview' = {
          name: 'mongo'
          properties: {
            name: 'myMongoDb'
            version: '6.0'
            size: 'M'
            credentials: {
              username: 'admin'
              password: 'MySecurePassword123'
            }
          }
        }

      Then connect a container to the database:

        resource myContainer 'Radius.Compute/containers@2025-10-01-preview' = {
          name: 'myContainer'
          properties: {
            connections: {
              mongo: {
                source: mongo.id
              }
            }
          }
        }

      The connection automatically injects environment variables into the container for all properties from the database. 
      The environment variables are named `CONNECTION_<CONNECTION-NAME>_<PROPERTY-NAME>`. 
      In this example, the connection name is `mongo`, so the environment variables will be:

      CONNECTION_MONGO_NAME
      CONNECTION_MONGO_VERSION
      CONNECTION_MONGO_USERNAME
      CONNECTION_MONGO_PASSWORD
      CONNECTION_MONGO_HOST
      CONNECTION_MONGO_PORT

      These variables expose the connection details and credentials of the MongoDB instance for use by your application.

      > ⚠️ **Security note:** The `CONNECTION_MONGO_PASSWORD` variable contains sensitive data and should be handled carefully. 
      Avoid logging or exposing it in application outputs.

    apiVersions:
      '2025-10-03-preview':
        schema:
          type: object
          properties:
            name:
              type: string
              description: The name of the MongoDB database instance.
              pattern: '^[a-zA-Z0-9\-]+$'
            version:
              type: string
              description: MongoDB server version to deploy.
              default: "6.0"
            size:
              type: string
              enum: ['S', 'M', 'L']
              description: |
                The deployment size profile for the MongoDB instance.  
                The Recipe implementation defines replicas, resource limits, and storage class for each size.

                - `S`: Small — development and testing  
                - `M`: Medium — staging or moderate workloads  
                - `L`: Large — production or high-availability
              default: "S"
            credentials:
              type: object
              description: Database credentials for the admin user.
              properties:
                username:
                  type: string
                  description: Admin username.
                  default: "admin"
                password:
                  type: string
                  description: Admin password.
                  minLength: 8
              required:
                - username
                - password
            host:
              type: string
              description: "(Read-only) The host name used to connect to the MongoDB database."
              readOnly: true
            port:
              type: integer
              description: "(Read-only) The port number used to connect to the MongoDB database."
              readOnly: true
          required:
            - name
            - version
            - size
            - credentials
